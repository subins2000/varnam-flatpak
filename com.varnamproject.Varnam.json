{
    "app-id": "com.varnamproject.Varnam",
    "runtime": "org.gnome.Platform",
    "runtime-version": "3.32",
    "sdk": "org.gnome.Sdk",
    "command": "varnam",
    "finish-args": [
        "--share=ipc",
        "--own-name=org.freedesktop.IBus.EnchantPython",
        "--talk-name=org.freedesktop.DBus",
        "--talk-name=org.freedesktop.IBus",
        "--talk-name=org.freedesktop.portal.IBus",
        "--filesystem=xdg-run/dconf",
        "--filesystem=~/.config/dconf:ro",
        "--talk-name=ca.desrt.dconf",
        "--env=DCONF_USER_CONFIG_DIR=.config/dconf"
    ],
    "modules": [
        {
            "name": "ruby",
            "config-opts": [
                "--disable-install-doc"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://cache.ruby-lang.org/pub/ruby/2.6/ruby-2.6.3.tar.gz",
                    "sha256": "577fd3795f22b8d91c1d4e6733637b0394d4082db659fccf224c774a2b1c82fb"
                }
            ]
        },
        {
            "name": "rubygems",
            "buildsystem": "simple",
            "build-commands": [
                "gem install --local ffi-1.11.1.gem --no-document"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "https://rubygems.org/gems/ffi-1.11.1.gem",
                    "sha256": "90ae2a7fe7ac4c0af30650fba8b75d93ff3611803c4937248118797ae5edbb1a"
                }
            ]
        },
        {
            "name": "varnam",
            "buildsystem": "cmake-ninja",
            "builddir": false,
            "post-install": [
                "find schemes/* -type f ! -name '*.*' -exec ./varnamc --compile {} \\;",
                "cmake -P cmake_install.cmake"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/subins2000/libvarnam.git",
                    "branch": "master"
                }
            ]
        },
        {
            "name": "varnam-import",
            "buildsystem": "simple",
            "build-commands": [
                "tar -xf ml.full.tar.gz"
            ],
            "sources": [
                {
                    "type": "file",
                    "url": "http://mirror.rackdc.com/savannah/varnamproject/words/ml.full.tar.gz",
                    "sha256": "b4d7208066a1395b033be5223ffbbc7759aabec6a7a2c60d9297cdd71c56dffd"
                }
            ]
        },
        {
            "name": "varnam-ibus",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DIBUS_INSTALL_PREFIX=/app"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/subins2000/libvarnam-ibus.git"
                }
            ]
        },
        {
            "name": "ibus-tmpl",
            "buildsystem": "simple",
            "build-commands": [
                "mv engine /app/bin/"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "file:///home/mint/Other/Projects/GitHub/ibus-tmpl"
                }
            ]
        },
        {
            "name": "varnam-wrapper",
            "buildsystem": "simple",
            "build-commands": [
                "chmod a+x varnam.sh",
                "mv varnam.sh /app/bin/varnam"
            ],
            "sources": [
                {
                    "type": "script",
                    "dest-filename": "varnam.sh",
                    "commands": [
                        "if [ \"$1\" = \"engine\" ]; then",
                        "   shift;",
                        "   cd /app/bin/engine",
                        "   python3 main.py \"$@\"",
                        "   #/app/bin/ibus-engine-varnam \"$@\"",
                        "else",
                        "   /app/bin/varnamc \"$@\"",
                        "fi"
                    ]
                }
            ]
        }
    ]
}
